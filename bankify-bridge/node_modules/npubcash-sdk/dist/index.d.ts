import { Nip98Response } from 'npubcash-types';
import { PaymentRequest as PaymentRequest_2 } from '@cashu/cashu-ts';
import { Quote } from 'npubcash-types';
import { QuotesResponse } from 'npubcash-types';
import { User } from 'npubcash-types';
import { UserResponse } from 'npubcash-types';

export declare class ApiError extends Error {
    statusCode: number;
    constructor(message: string, status?: number);
}

declare type ApiResponse = QuotesResponse | UserResponse | Nip98Response;

declare interface AuthenticatedRequest {
    <T extends ApiResponse>(path: string, options?: RequestOptions): Promise<T>;
}

/**
 * Abstraction for authentication used by {@link NPCClient}.
 *
 * Implementations should provide:
 * - an HTTP auth token (e.g., a short-lived JWT in `Bearer <token>` or Nostr token form)
 * - a NIP-98 token for WebSocket challenge/response
 */
export declare interface AuthProvider {
    getAuthToken(url: string, method: string): Promise<string>;
    getNostrToken(url: string, method: string): Promise<string>;
}

/**
 * Logger that writes to the browser/Node console with SDK‑scoped prefixes.
 */
export declare class ConsoleLogger implements Logger {
    info(message: string, ...meta: any[]): void;
    warn(message: string, ...meta: any[]): void;
    error(message: string, ...meta: any[]): void;
    debug(message: string, ...meta: any[]): void;
}

export declare type EventTemplate = Omit<SignedEvent, "id" | "sig" | "pubkey">;

/**
 * Default authentication provider using NIP‑98 to fetch and cache short‑lived JWTs.
 *
 * Flow:
 * 1. Signs a NIP‑98 challenge against `GET {baseUrl}/api/v2/auth/nip98`
 * 2. Exchanges the NIP‑98 token for a short‑lived JWT (cached ~5 minutes)
 * 3. Provides `Bearer <jwt>` for HTTP and NIP‑98 tokens for WebSocket auth
 */
export declare class JWTAuthProvider {
    private storedToken?;
    private signer;
    private readonly _baseUrl;
    private readonly logger?;
    /**
     * @param baseUrl Base URL of the NpubCash server (e.g., `https://npubx.cash`).
     * @param signer Function that signs a Nostr event template (NIP‑98).
     * @param logger Optional logger for diagnostics.
     */
    constructor(baseUrl: string, signer: SigningFunc, logger?: Logger);
    /**
     * Returns an HTTP Authorization header value.
     * Fetches and caches a short‑lived JWT via NIP‑98 if needed.
     * @param url The URL being requested (scheme+host+path only used for logging/context).
     * @param method HTTP method (for context).
     * @returns Authorization header value in the form `Bearer <token>`.
     */
    getAuthToken(url: string, method: string): Promise<string>;
    /**
     * Produce a NIP‑98 token for challenge/response authentication (e.g., WebSocket).
     * @param url The URL being authenticated.
     * @param method The HTTP verb indicated by the server challenge.
     * @returns Raw NIP‑98 token string.
     */
    getNostrToken(url: string, method: string): Promise<string>;
    private _ensureCachedToken;
}

/**
 * Minimal logging interface used by the SDK.
 *
 * Provide your own implementation or use {@link ConsoleLogger}.
 */
export declare interface Logger {
    /** Log informational events. */
    info(message: string, ...meta: any[]): void;
    /** Log warnings about unexpected but recoverable situations. */
    warn(message: string, ...meta: any[]): void;
    /** Log errors and failures. */
    error(message: string, ...meta: any[]): void;
    /** Log verbose debugging details. */
    debug(message: string, ...meta: any[]): void;
}

/**
 * High‑level client for the NpubCash HTTP and realtime APIs.
 *
 * - HTTP requests are authenticated via {@link AuthProvider.getAuthToken}
 * - WebSocket auth uses NIP‑98 via {@link AuthProvider.getNostrToken}
 *
 * @example
 * const baseUrl = "https://npubx.cash";
 * const signer = (tpl) => window.nostr!.signEvent(tpl);
 * const client = new NPCClient(baseUrl, new JWTAuthProvider(baseUrl, signer));
 * const quotes = await client.getAllQuotes();
 */
export declare class NPCClient {
    private readonly _baseUrl;
    private readonly authProvider;
    /**
     * Settings API for the authenticated user account.
     * Use {@link SettingsManager.setMintUrl} and {@link SettingsManager.setLock}.
     */
    readonly settings: SettingsManager;
    private logger;
    /**
     * Create a client.
     * @param baseUrl Base URL of the NpubCash server, e.g. `https://npubx.cash`.
     * @param authProvider Provider that supplies HTTP and NIP‑98 auth tokens.
     */
    constructor(baseUrl: string, authProvider: AuthProvider);
    /**
     * Set a logger implementation for SDK diagnostics.
     * @param logger Logger implementation to use (e.g., {@link ConsoleLogger}).
     */
    setLogger(logger: Logger): void;
    /**
     * Fetch account information for the authenticated user.
     *
     * @returns The user's account information.
     * @throws {ApiError} When the request fails.
     */
    getInfo(): Promise<User>;
    /**
     * Set the username for the authenticated user.
     *
     * This method supports the Cashu payment flow. Call without a token first
     * to receive payment requirements, then call again with the token to complete.
     *
     * @param username The desired username.
     * @param token Optional Cashu token for payment.
     * @throws {PaymentRequiredError} When payment is required. Contains the
     *         {@link PaymentRequest} with amount and mint details.
     * @throws {ApiError} When the request fails for other reasons.
     */
    setUsername(username: string, token?: string): Promise<ApiResponse>;
    /**
     * Fetch quotes created since a UNIX timestamp (in seconds).
     * Handles pagination internally.
     * @param since UNIX timestamp in seconds.
     * @returns All quotes since the given time.
     */
    getQuotesSince(since: number): Promise<Quote[]>;
    /**
     * Fetch all quotes for the authenticated user.
     * Handles pagination internally.
     * @returns All available quotes.
     */
    getAllQuotes(): Promise<Quote[]>;
    /**
     * Subscribe to realtime quote update notifications.
     *
     * Opens a WebSocket to `${baseUrl}/api/v2/ws/quote` and authenticates via NIP‑98
     * challenge/response. The callback receives the updated `quoteId`.
     *
     * @param onUpdate Called whenever a quote is updated.
     * @param onError Optional callback for WebSocket/auth errors. Receives a message.
     * @returns Disposer function to close the subscription.
     */
    subscribe(onUpdate: (quoteId: string) => void, onError?: (msg: string) => void): () => void;
    private _fetchPaginatedQuotes;
    private _authenticatedRequest;
}

export declare class PaymentRequiredError extends ApiError {
    paymentRequest: PaymentRequest_2;
    constructor(message: string, paymentRequest: PaymentRequest_2);
}

declare interface RequestOptions extends RequestInit {
    params?: Record<string, string | number | boolean>;
}

/**
 * Settings API
 *
 * Not exported directly; consumers use the instance available on the client.
 */
declare class SettingsManager {
    private readonly _authenticatedRequest;
    private logger?;
    constructor(authenticatedRequest: AuthenticatedRequest, logger?: Logger);
    /* Excluded from this release type: setLogger */
    /**
     * Update the user's preferred mint URL.
     * @param mintUrl Fully-qualified Cashu mint URL.
     * @returns Updated user settings resource.
     */
    setMintUrl(mintUrl: string): Promise<UserResponse>;
    /**
     * Enable or disable quote locking for the user.
     * @param lockQuotes When true, new quotes are locked by default.
     * @returns Updated user settings resource.
     */
    setLock(lockQuotes: boolean): Promise<UserResponse>;
}

export declare type SignedEvent = {
    kind: number;
    tags: string[][];
    content: string;
    created_at: number;
    pubkey: string;
    id: string;
    sig: string;
};

export declare type SigningFunc = (t: EventTemplate) => Promise<SignedEvent>;

export { }
